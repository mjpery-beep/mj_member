(function(){"use strict";var Q,w,he,N,me,fe,pe,be,ae,re,se,q={},ve=[],Ve=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function T(e,t){for(var n in t)e[n]=t[n];return e}function le(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ge(e,t,n){var a,l,r,i={};for(r in t)r=="key"?a=t[r]:r=="ref"?l=t[r]:i[r]=t[r];if(arguments.length>2&&(i.children=arguments.length>3?Q.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)i[r]===void 0&&(i[r]=e.defaultProps[r]);return X(e,i,a,l,null)}function X(e,t,n,a,l){var r={type:e,props:t,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++he,__i:-1,__u:0};return l==null&&w.vnode!=null&&w.vnode(r),r}function F(e){return e.children}function Y(e,t){this.props=e,this.context=t}function R(e,t){if(t==null)return e.__?R(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?R(e):null}function je(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return je(e)}}function ye(e){(!e.__d&&(e.__d=!0)&&N.push(e)&&!Z.__r++||me!=w.debounceRendering)&&((me=w.debounceRendering)||fe)(Z)}function Z(){for(var e,t,n,a,l,r,i,c=1;N.length;)N.length>c&&N.sort(pe),e=N.shift(),c=N.length,e.__d&&(n=void 0,a=void 0,l=(a=(t=e).__v).__e,r=[],i=[],t.__P&&((n=T({},a)).__v=a.__v+1,w.vnode&&w.vnode(n),ie(t.__P,n,a,t.__n,t.__P.namespaceURI,32&a.__u?[l]:null,r,l??R(a),!!(32&a.__u),i),n.__v=a.__v,n.__.__k[n.__i]=n,Ee(r,n,i),a.__e=a.__=null,n.__e!=l&&je(n)));Z.__r=0}function ke(e,t,n,a,l,r,i,c,h,_,u){var s,m,p,f,S,y,k,v=a&&a.__k||ve,g=t.length;for(h=Ge(n,t,v,h,g),s=0;s<g;s++)(p=n.__k[s])!=null&&(m=p.__i==-1?q:v[p.__i]||q,p.__i=s,y=ie(e,p,m,l,r,i,c,h,_,u),f=p.__e,p.ref&&m.ref!=p.ref&&(m.ref&&_e(m.ref,null,p),u.push(p.ref,p.__c||f,p)),S==null&&f!=null&&(S=f),(k=!!(4&p.__u))||m.__k===p.__k?h=Se(p,h,e,k):typeof p.type=="function"&&y!==void 0?h=y:f&&(h=f.nextSibling),p.__u&=-7);return n.__e=S,h}function Ge(e,t,n,a,l){var r,i,c,h,_,u=n.length,s=u,m=0;for(e.__k=new Array(l),r=0;r<l;r++)(i=t[r])!=null&&typeof i!="boolean"&&typeof i!="function"?(typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?i=e.__k[r]=X(null,i,null,null,null):J(i)?i=e.__k[r]=X(F,{children:i},null,null,null):i.constructor==null&&i.__b>0?i=e.__k[r]=X(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):e.__k[r]=i,h=r+m,i.__=e,i.__b=e.__b+1,(_=i.__i=Ke(i,n,h,s))!=-1&&(s--,(c=n[_])&&(c.__u|=2)),c==null||c.__v==null?(_==-1&&(l>u?m--:l<u&&m++),typeof i.type!="function"&&(i.__u|=4)):_!=h&&(_==h-1?m--:_==h+1?m++:(_>h?m--:m++,i.__u|=4))):e.__k[r]=null;if(s)for(r=0;r<u;r++)(c=n[r])!=null&&!(2&c.__u)&&(c.__e==a&&(a=R(c)),Ae(c,c));return a}function Se(e,t,n,a){var l,r;if(typeof e.type=="function"){for(l=e.__k,r=0;l&&r<l.length;r++)l[r]&&(l[r].__=e,t=Se(l[r],t,n,a));return t}e.__e!=t&&(a&&(t&&e.type&&!t.parentNode&&(t=R(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ke(e,t,n,a){var l,r,i,c=e.key,h=e.type,_=t[n],u=_!=null&&(2&_.__u)==0;if(_===null&&c==null||u&&c==_.key&&h==_.type)return n;if(a>(u?1:0)){for(l=n-1,r=n+1;l>=0||r<t.length;)if((_=t[i=l>=0?l--:r++])!=null&&!(2&_.__u)&&c==_.key&&h==_.type)return i}return-1}function we(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Ve.test(t)?n:n+"px"}function ee(e,t,n,a,l){var r,i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof a=="string"&&(e.style.cssText=a=""),a)for(t in a)n&&t in n||we(e.style,t,"");if(n)for(t in n)a&&n[t]==a[t]||we(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(be,"$1")),i=t.toLowerCase(),t=i in e||t=="onFocusOut"||t=="onFocusIn"?i.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?a?n.u=a.u:(n.u=ae,e.addEventListener(t,r?se:re,r)):e.removeEventListener(t,r?se:re,r);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Ce(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ae++;else if(t.t<n.u)return;return n(w.event?w.event(t):t)}}}function ie(e,t,n,a,l,r,i,c,h,_){var u,s,m,p,f,S,y,k,v,g,b,d,j,M,x,$,G,P=t.type;if(t.constructor!=null)return null;128&n.__u&&(h=!!(32&n.__u),r=[c=t.__e=n.__e]),(u=w.__b)&&u(t);e:if(typeof P=="function")try{if(k=t.props,v="prototype"in P&&P.prototype.render,g=(u=P.contextType)&&a[u.__c],b=u?g?g.props.value:u.__:a,n.__c?y=(s=t.__c=n.__c).__=s.__E:(v?t.__c=s=new P(k,b):(t.__c=s=new Y(k,b),s.constructor=P,s.render=Je),g&&g.sub(s),s.state||(s.state={}),s.__n=a,m=s.__d=!0,s.__h=[],s._sb=[]),v&&s.__s==null&&(s.__s=s.state),v&&P.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=T({},s.__s)),T(s.__s,P.getDerivedStateFromProps(k,s.__s))),p=s.props,f=s.state,s.__v=t,m)v&&P.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),v&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(v&&P.getDerivedStateFromProps==null&&k!==p&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(k,b),t.__v==n.__v||!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(k,s.__s,b)===!1){for(t.__v!=n.__v&&(s.props=k,s.state=s.__s,s.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(O){O&&(O.__=t)}),d=0;d<s._sb.length;d++)s.__h.push(s._sb[d]);s._sb=[],s.__h.length&&i.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(k,s.__s,b),v&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(p,f,S)})}if(s.context=b,s.props=k,s.__P=e,s.__e=!1,j=w.__r,M=0,v){for(s.state=s.__s,s.__d=!1,j&&j(t),u=s.render(s.props,s.state,s.context),x=0;x<s._sb.length;x++)s.__h.push(s._sb[x]);s._sb=[]}else do s.__d=!1,j&&j(t),u=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++M<25);s.state=s.__s,s.getChildContext!=null&&(a=T(T({},a),s.getChildContext())),v&&!m&&s.getSnapshotBeforeUpdate!=null&&(S=s.getSnapshotBeforeUpdate(p,f)),$=u,u!=null&&u.type===F&&u.key==null&&($=Ie(u.props.children)),c=ke(e,J($)?$:[$],t,n,a,l,r,i,c,h,_),s.base=t.__e,t.__u&=-161,s.__h.length&&i.push(s),y&&(s.__E=s.__=null)}catch(O){if(t.__v=null,h||r!=null)if(O.then){for(t.__u|=h?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,t.__e=c}else{for(G=r.length;G--;)le(r[G]);oe(t)}else t.__e=n.__e,t.__k=n.__k,O.then||oe(t);w.__e(O,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):c=t.__e=Qe(n.__e,t,n,a,l,r,i,h,_);return(u=w.diffed)&&u(t),128&t.__u?void 0:c}function oe(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(oe)}function Ee(e,t,n){for(var a=0;a<n.length;a++)_e(n[a],n[++a],n[++a]);w.__c&&w.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(r){r.call(l)})}catch(r){w.__e(r,l.__v)}})}function Ie(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:J(e)?e.map(Ie):T({},e)}function Qe(e,t,n,a,l,r,i,c,h){var _,u,s,m,p,f,S,y=n.props||q,k=t.props,v=t.type;if(v=="svg"?l="http://www.w3.org/2000/svg":v=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),r!=null){for(_=0;_<r.length;_++)if((p=r[_])&&"setAttribute"in p==!!v&&(v?p.localName==v:p.nodeType==3)){e=p,r[_]=null;break}}if(e==null){if(v==null)return document.createTextNode(k);e=document.createElementNS(l,v,k.is&&k),c&&(w.__m&&w.__m(t,r),c=!1),r=null}if(v==null)y===k||c&&e.data==k||(e.data=k);else{if(r=r&&Q.call(e.childNodes),!c&&r!=null)for(y={},_=0;_<e.attributes.length;_++)y[(p=e.attributes[_]).name]=p.value;for(_ in y)if(p=y[_],_!="children"){if(_=="dangerouslySetInnerHTML")s=p;else if(!(_ in k)){if(_=="value"&&"defaultValue"in k||_=="checked"&&"defaultChecked"in k)continue;ee(e,_,null,p,l)}}for(_ in k)p=k[_],_=="children"?m=p:_=="dangerouslySetInnerHTML"?u=p:_=="value"?f=p:_=="checked"?S=p:c&&typeof p!="function"||y[_]===p||ee(e,_,p,y[_],l);if(u)c||s&&(u.__html==s.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(s&&(e.innerHTML=""),ke(t.type=="template"?e.content:e,J(m)?m:[m],t,n,a,v=="foreignObject"?"http://www.w3.org/1999/xhtml":l,r,i,r?r[0]:n.__k&&R(n,0),c,h),r!=null)for(_=r.length;_--;)le(r[_]);c||(_="value",v=="progress"&&f==null?e.removeAttribute("value"):f!=null&&(f!==e[_]||v=="progress"&&!f||v=="option"&&f!=y[_])&&ee(e,_,f,y[_],l),_="checked",S!=null&&S!=e[_]&&ee(e,_,S,y[_],l))}return e}function _e(e,t,n){try{if(typeof e=="function"){var a=typeof e.__u=="function";a&&e.__u(),a&&t==null||(e.__u=e(t))}else e.current=t}catch(l){w.__e(l,n)}}function Ae(e,t,n){var a,l;if(w.unmount&&w.unmount(e),(a=e.ref)&&(a.current&&a.current!=e.__e||_e(a,null,t)),(a=e.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(r){w.__e(r,t)}a.base=a.__P=null}if(a=e.__k)for(l=0;l<a.length;l++)a[l]&&Ae(a[l],t,n||typeof e.type!="function");n||le(e.__e),e.__c=e.__=e.__e=void 0}function Je(e,t,n){return this.constructor(e,n)}function Xe(e,t,n){var a,l,r,i;t==document&&(t=document.documentElement),w.__&&w.__(e,t),l=(a=!1)?null:t.__k,r=[],i=[],ie(t,e=t.__k=ge(F,null,[e]),l||q,q,t.namespaceURI,l?null:t.firstChild?Q.call(t.childNodes):null,r,l?l.__e:t.firstChild,a,i),Ee(r,e,i)}Q=ve.slice,w={__e:function(e,t,n,a){for(var l,r,i;t=t.__;)if((l=t.__c)&&!l.__)try{if((r=l.constructor)&&r.getDerivedStateFromError!=null&&(l.setState(r.getDerivedStateFromError(e)),i=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,a||{}),i=l.__d),i)return l.__E=l}catch(c){e=c}throw e}},he=0,Y.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=T({},this.state),typeof e=="function"&&(e=e(T({},n),this.props)),e&&T(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ye(this))},Y.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ye(this))},Y.prototype.render=F,N=[],fe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,pe=function(e,t){return e.__v.__b-t.__v.__b},Z.__r=0,be=/(PointerCapture)$|Capture$/i,ae=0,re=Ce(!1),se=Ce(!0);var Ye=0;function o(e,t,n,a,l,r){t||(t={});var i,c,h=t;if("ref"in h)for(c in h={},t)c=="ref"?i=t[c]:h[c]=t[c];var _={type:e,props:h,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ye,__i:-1,__u:0,__source:l,__self:r};if(typeof e=="function"&&(i=e.defaultProps))for(c in i)h[c]===void 0&&(h[c]=i[c]);return w.vnode&&w.vnode(_),_}var z,I,ce,Le,te=0,Pe=[],A=w,Me=A.__b,xe=A.__r,$e=A.diffed,Te=A.__c,Oe=A.unmount,De=A.__;function de(e,t){A.__h&&A.__h(I,e,te||t),te=0;var n=I.__H||(I.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function C(e){return te=1,Ze(Fe,e)}function Ze(e,t,n){var a=de(z++,2);if(a.t=e,!a.__c&&(a.__=[Fe(void 0,t),function(c){var h=a.__N?a.__N[0]:a.__[0],_=a.t(h,c);h!==_&&(a.__N=[_,a.__[1]],a.__c.setState({}))}],a.__c=I,!I.__f)){var l=function(c,h,_){if(!a.__c.__H)return!0;var u=a.__c.__H.__.filter(function(m){return!!m.__c});if(u.every(function(m){return!m.__N}))return!r||r.call(this,c,h,_);var s=a.__c.props!==c;return u.forEach(function(m){if(m.__N){var p=m.__[0];m.__=m.__N,m.__N=void 0,p!==m.__[0]&&(s=!0)}}),r&&r.call(this,c,h,_)||s};I.__f=!0;var r=I.shouldComponentUpdate,i=I.componentWillUpdate;I.componentWillUpdate=function(c,h,_){if(this.__e){var u=r;r=void 0,l(c,h,_),r=u}i&&i.call(this,c,h,_)},I.shouldComponentUpdate=l}return a.__N||a.__}function V(e,t){var n=de(z++,3);!A.__s&&Ue(n.__H,t)&&(n.__=e,n.u=t,I.__H.__h.push(n))}function Ne(e){return te=5,W(function(){return{current:e}},[])}function W(e,t){var n=de(z++,7);return Ue(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function et(){for(var e;e=Pe.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(ne),e.__H.__h.forEach(ue),e.__H.__h=[]}catch(t){e.__H.__h=[],A.__e(t,e.__v)}}A.__b=function(e){I=null,Me&&Me(e)},A.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),De&&De(e,t)},A.__r=function(e){xe&&xe(e),z=0;var t=(I=e.__c).__H;t&&(ce===I?(t.__h=[],I.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(ne),t.__h.forEach(ue),t.__h=[],z=0)),ce=I},A.diffed=function(e){$e&&$e(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Pe.push(t)!==1&&Le===A.requestAnimationFrame||((Le=A.requestAnimationFrame)||tt)(et)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ce=I=null},A.__c=function(e,t){t.some(function(n){try{n.__h.forEach(ne),n.__h=n.__h.filter(function(a){return!a.__||ue(a)})}catch(a){t.some(function(l){l.__h&&(l.__h=[])}),t=[],A.__e(a,n.__v)}}),Te&&Te(e,t)},A.unmount=function(e){Oe&&Oe(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(a){try{ne(a)}catch(l){t=l}}),n.__H=void 0,t&&A.__e(t,n.__v))};var He=typeof requestAnimationFrame=="function";function tt(e){var t,n=function(){clearTimeout(a),He&&cancelAnimationFrame(t),setTimeout(e)},a=setTimeout(n,35);He&&(t=requestAnimationFrame(n))}function ne(e){var t=I,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),I=t}function ue(e){var t=I;e.__c=e.__(),I=t}function Ue(e,t){return!e||e.length!==t.length||t.some(function(n,a){return n!==e[a]})}function Fe(e,t){return typeof t=="function"?t(e):t}function B(e){const t=parseInt(e,10);return isNaN(t)?null:t}function Re(e){if(!e)return!1;const t=String(e).toLowerCase();return t==="brouillon"||t==="draft"}async function H(e,t={}){var c,h,_;const n=((c=window.MjMemberAnimateur)==null?void 0:c.ajaxUrl)||"/wp-admin/admin-ajax.php",a=((h=window.MjMemberAnimateur)==null?void 0:h.nonce)||"",l=new FormData;l.append("action",e),l.append("nonce",a),Object.keys(t).forEach(u=>{typeof t[u]=="object"&&t[u]!==null?l.append(u,JSON.stringify(t[u])):l.append(u,t[u])});const r=await fetch(n,{method:"POST",credentials:"same-origin",body:l});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();if(!i.success){const u=((_=i.data)==null?void 0:_.message)||"An error occurred";throw new Error(u)}return i.data}function nt({events:e,allEvents:t,selectedId:n,onSelect:a,settings:l,global:r}){const i=Ne(null),[c,h]=C(!1),[_,u]=C(!1),s=e.length>0?e:t;V(()=>{m()},[s]);const m=()=>{if(!i.current)return;const{scrollLeft:f,scrollWidth:S,clientWidth:y}=i.current;h(f>0),u(f+y<S-1)},p=f=>{if(!i.current)return;const S=i.current.clientWidth*.8,y=f==="prev"?i.current.scrollLeft-S:i.current.scrollLeft+S;i.current.scrollTo({left:y,behavior:"smooth"}),setTimeout(m,300)};return s.length===0?o("div",{class:"mj-animateur-dashboard__empty",children:o("p",{children:"Aucun événement disponible."})}):o("div",{class:"mj-animateur-dashboard__event-section",children:o("div",{class:"mj-animateur-dashboard__event-carousel",children:[c&&o("button",{class:"mj-animateur-dashboard__event-nav mj-animateur-dashboard__event-nav--prev",onClick:()=>p("prev"),"aria-label":"Événement précédent",children:"←"}),o("div",{ref:i,class:"mj-animateur-dashboard__event-track",onScroll:m,children:s.map(f=>o(at,{event:f,selected:f.id===n,onSelect:a},f.id))}),_&&o("button",{class:"mj-animateur-dashboard__event-nav mj-animateur-dashboard__event-nav--next",onClick:()=>p("next"),"aria-label":"Événement suivant",children:"→"})]})})}function at({event:e,selected:t,onSelect:n}){var _,u,s,m,p,f;const a=((_=e.cover)==null?void 0:_.url)||((u=e.cover)==null?void 0:u.thumb)||e.coverUrl||e.locationCoverUrl||"",l=e.title||`Événement #${e.id}`,r=((s=e.meta)==null?void 0:s.dateLabel)||e.dateLabel||"",i=((m=e.meta)==null?void 0:m.typeLabel)||e.typeLabel||"",c=((p=e.meta)==null?void 0:p.priceLabel)||e.priceLabel||"",h=((f=e.meta)==null?void 0:f.participantCountLabel)||"";return o("div",{class:`mj-animateur-dashboard__event-card ${t?"is-selected":""}`,onClick:()=>n(e.id),role:"button",tabIndex:0,"data-event-id":e.id,onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),n(e.id))},children:[a&&o("div",{class:"mj-animateur-dashboard__event-card-media",children:o("img",{src:a,alt:l,loading:"lazy",decoding:"async"})}),o("div",{class:"mj-animateur-dashboard__event-card-content",children:[o("h3",{class:"mj-animateur-dashboard__event-card-title",children:l}),o("div",{class:"mj-animateur-dashboard__event-card-meta",children:[r&&o("span",{class:"mj-animateur-dashboard__event-card-meta-item",children:r}),i&&o("span",{class:"mj-animateur-dashboard__event-card-meta-item",children:i}),c&&o("span",{class:"mj-animateur-dashboard__event-card-meta-item",children:c}),h&&o("span",{class:"mj-animateur-dashboard__event-card-meta-item",children:h})]})]})]})}function rt({occurrences:e,selected:t,onSelect:n}){const a=Ne(null),[l,r]=C(!1),[i,c]=C(!1);if(!e||e.length===0)return null;V(()=>{if(h(),a.current&&t){const u=a.current.querySelector('[data-selected="true"]');u&&u.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}},[e,t]);const h=()=>{if(!a.current)return;const{scrollLeft:u,scrollWidth:s,clientWidth:m}=a.current;r(u>0),c(u+m<s-1)},_=u=>{if(!a.current)return;const s=200,m=u==="prev"?a.current.scrollLeft-s:a.current.scrollLeft+s;a.current.scrollTo({left:m,behavior:"smooth"}),setTimeout(h,300)};return o("div",{class:"mj-animateur-dashboard__agenda",children:[o("h3",{class:"mj-animateur-dashboard__agenda-title",children:"Occurrences"}),o("div",{class:"mj-animateur-dashboard__agenda-carousel",children:[l&&o("button",{class:"mj-animateur-dashboard__agenda-nav mj-animateur-dashboard__agenda-nav--prev",onClick:()=>_("prev"),"aria-label":"Occurrence précédente",children:"←"}),o("div",{ref:a,class:"mj-animateur-dashboard__agenda-track",onScroll:h,children:e.map(u=>o(st,{occurrence:u,selected:u.start===t,onSelect:n},u.start))}),i&&o("button",{class:"mj-animateur-dashboard__agenda-nav mj-animateur-dashboard__agenda-nav--next",onClick:()=>_("next"),"aria-label":"Occurrence suivante",children:"→"})]})]})}function st({occurrence:e,selected:t,onSelect:n}){e.counts;const a=e.isPast,l=e.isToday,r=e.isNext;let i="";return l?i="is-today":r?i="is-next":a&&(i="is-past"),o("button",{class:`mj-animateur-dashboard__agenda-item ${t?"is-selected":""} ${i}`,onClick:()=>n(e.start),"data-selected":t?"true":"false","data-occurrence":e.start,children:[o("div",{class:"mj-animateur-dashboard__agenda-item-label",children:e.label}),o("div",{class:"mj-animateur-dashboard__agenda-item-summary",children:e.summary||"Aucun pointage"}),l&&o("span",{class:"mj-animateur-dashboard__agenda-item-badge",children:"Aujourd'hui"}),r&&!l&&o("span",{class:"mj-animateur-dashboard__agenda-item-badge",children:"Prochain"})]})}function lt({participants:e,event:t,occurrence:n,settings:a,onAttendanceChange:l,onPaymentToggle:r,onRemoveRegistration:i,loading:c}){var h,_;return!e||e.length===0?o("div",{class:"mj-animateur-dashboard__no-data",children:o("p",{children:"Aucun participant pour cette occurrence."})}):o("div",{class:"mj-animateur-dashboard__table-wrapper",children:o("table",{class:"mj-animateur-dashboard__table",children:[o("thead",{children:o("tr",{children:[o("th",{children:"Participant"}),((h=a.attendance)==null?void 0:h.enabled)&&o("th",{children:"Présence"}),((_=a.payment)==null?void 0:_.enabled)&&o("th",{children:"Paiement"}),o("th",{children:"Actions"})]})}),o("tbody",{children:e.map(u=>o(it,{participant:u,occurrence:n,settings:a,onAttendanceChange:l,onPaymentToggle:r,onRemoveRegistration:i,loading:c},u.memberId))})]})})}function it({participant:e,occurrence:t,settings:n,onAttendanceChange:a,onPaymentToggle:l,onRemoveRegistration:r,loading:i}){var _,u,s,m,p;const c=((_=e.attendance)==null?void 0:_[t])||"pending",h=e.payment||{};return o("tr",{class:"mj-animateur-dashboard__table-row",children:[o("td",{class:"mj-animateur-dashboard__participant-cell",children:o("div",{class:"mj-animateur-dashboard__participant-info",children:[((u=e.avatar)==null?void 0:u.url)&&o("img",{src:e.avatar.url,alt:e.avatar.alt||"",class:"mj-animateur-dashboard__participant-avatar"}),o("div",{children:[o("div",{class:"mj-animateur-dashboard__participant-name",children:e.fullName}),(e.age||e.city)&&o("div",{class:"mj-animateur-dashboard__participant-meta",children:[e.age&&o("span",{children:[e.age," ans"]}),e.city&&o("span",{children:e.city})]})]})]})}),((s=n.attendance)==null?void 0:s.enabled)&&o("td",{class:"mj-animateur-dashboard__attendance-cell",children:o(ot,{value:c,onChange:f=>a(e.memberId,e.registrationId,f),disabled:i})}),((m=n.payment)==null?void 0:m.enabled)&&o("td",{class:"mj-animateur-dashboard__payment-cell",children:o("button",{class:`mj-animateur-dashboard__payment-toggle ${h.status==="paid"?"is-paid":""}`,onClick:()=>l(e.registrationId),disabled:i,children:h.status_label||"À payer"})}),o("td",{class:"mj-animateur-dashboard__actions-cell",children:((p=n.registrations)==null?void 0:p.canDelete)&&o("button",{class:"mj-animateur-dashboard__action-button mj-animateur-dashboard__action-button--danger",onClick:()=>r(e.registrationId),disabled:i,title:"Supprimer",children:"✕"})})]})}function ot({value:e,onChange:t,disabled:n}){return o("div",{class:"mj-animateur-dashboard__attendance-control",children:[{value:"present",label:"Présent"},{value:"absent",label:"Absent"},{value:"pending",label:"À confirmer"}].map(l=>o("button",{class:`mj-animateur-dashboard__attendance-option ${e===l.value?"is-active":""}`,onClick:()=>t(l.value),disabled:n,"data-status":l.value,children:l.label},l.value))})}function _t({participants:e,onSendSms:t,loading:n}){const[a,l]=C(""),[r,i]=C("all"),c=()=>{if(!a.trim()){alert("Veuillez saisir un message.");return}let _=[];if(r==="all"?_=e.filter(u=>u.smsAllowed).map(u=>u.memberId):_=e.filter(u=>u.smsAllowed).map(u=>u.memberId),_.length===0){alert("Aucun participant ne peut recevoir de SMS.");return}t(a,_),l("")},h=e.filter(_=>_.smsAllowed).length;return o("div",{class:"mj-animateur-dashboard__sms",children:[o("h3",{class:"mj-animateur-dashboard__sms-title",children:"Envoyer un SMS"}),o("p",{class:"mj-animateur-dashboard__sms-info",children:[h," participant(s) peuvent recevoir des SMS"]}),o("textarea",{class:"mj-animateur-dashboard__sms-message",placeholder:"Votre message...",value:a,onInput:_=>l(_.target.value),rows:4,disabled:n}),o("button",{class:"mj-animateur-dashboard__button",onClick:c,disabled:n||!a.trim()||h===0,children:n?"Envoi...":"Envoyer le SMS"})]})}function ct({event:e,occurrence:t,global:n,onClose:a,onMembersAdded:l}){const[r,i]=C([]),[c,h]=C({}),[_,u]=C(""),[s,m]=C(!1),[p,f]=C(1),[S,y]=C(!1);V(()=>{k(!0)},[_]);const k=async(b=!1)=>{try{m(!0);const d=await H("mj_member_animateur_search_members",{event_id:e.id,occurrence:t,search:_,page:b?1:p,per_page:20});b?(i(d.members||[]),f(1)):i(j=>[...j,...d.members||[]]),y(!!d.hasMore)}catch(d){console.error("Failed to load members:",d)}finally{m(!1)}},v=b=>{h(d=>{const j={...d};return j[b]?delete j[b]:j[b]=!0,j})},g=async()=>{const b=Object.keys(c).map(Number);if(b.length===0){alert("Sélectionnez au moins un membre.");return}try{m(!0);const d=await H("mj_member_animateur_add_members",{event_id:e.id,member_ids:b,occurrence_scope:{mode:e.type==="atelier"?"custom":"all",occurrences:e.type==="atelier"?[t]:[]}});l(d.event)}catch(d){alert(d.message||"Impossible d'ajouter les membres.")}finally{m(!1)}};return o("div",{class:"mj-animateur-dashboard__modal-overlay",onClick:a,children:o("div",{class:"mj-animateur-dashboard__modal",onClick:b=>b.stopPropagation(),children:[o("div",{class:"mj-animateur-dashboard__modal-header",children:[o("h3",{children:"Ajouter des participants"}),o("button",{class:"mj-animateur-dashboard__modal-close",onClick:a,children:"✕"})]}),o("div",{class:"mj-animateur-dashboard__modal-body",children:[o("input",{type:"search",class:"mj-animateur-dashboard__search",placeholder:"Rechercher un membre...",value:_,onInput:b=>u(b.target.value)}),o("div",{class:"mj-animateur-dashboard__member-list",children:r.map(b=>o("label",{class:"mj-animateur-dashboard__member-item",children:[o("input",{type:"checkbox",checked:!!c[b.id],onChange:()=>v(b.id),disabled:b.alreadyAssigned||!b.eligible||s}),o("span",{class:"mj-animateur-dashboard__member-name",children:b.fullName}),b.age&&o("span",{class:"mj-animateur-dashboard__member-meta",children:[b.age," ans"]}),b.alreadyAssigned&&o("span",{class:"mj-animateur-dashboard__member-status",children:"Déjà inscrit"}),!b.eligible&&o("span",{class:"mj-animateur-dashboard__member-status mj-animateur-dashboard__member-status--warning",children:"Non éligible"})]},b.id))}),s&&o("div",{class:"mj-animateur-dashboard__loading",children:"Chargement..."})]}),o("div",{class:"mj-animateur-dashboard__modal-footer",children:[o("button",{class:"mj-animateur-dashboard__button",onClick:g,disabled:s||Object.keys(c).length===0,children:["Ajouter (",Object.keys(c).length,")"]}),o("button",{class:"mj-animateur-dashboard__button mj-animateur-dashboard__button--secondary",onClick:a,disabled:s,children:"Annuler"})]})]})})}function dt({global:e,onClose:t,onMemberCreated:n}){const[a,l]=C({first_name:"",last_name:"",birth_date:"",email:""}),[r,i]=C({}),[c,h]=C(!1),[_,u]=C(""),s=(f,S)=>{l(y=>({...y,[f]:S})),r[f]&&i(y=>{const k={...y};return delete k[f],k})},m=()=>{const f={};return a.first_name.trim()||(f.first_name="Le prénom est obligatoire."),a.last_name.trim()||(f.last_name="Le nom est obligatoire."),a.birth_date?/^\d{4}-\d{2}-\d{2}$/.test(a.birth_date)||(f.birth_date="Format de date invalide."):f.birth_date="La date de naissance est obligatoire.",a.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)&&(f.email="Adresse email invalide."),i(f),Object.keys(f).length===0};return o("div",{class:"mj-animateur-dashboard__modal-overlay",onClick:t,children:o("div",{class:"mj-animateur-dashboard__modal",onClick:f=>f.stopPropagation(),children:[o("div",{class:"mj-animateur-dashboard__modal-header",children:[o("h3",{children:"Créer un nouveau membre"}),o("button",{class:"mj-animateur-dashboard__modal-close",onClick:t,children:"✕"})]}),o("form",{onSubmit:async f=>{if(f.preventDefault(),!!m())try{h(!0),u("");const S=await H("mj_member_animateur_quick_create_member",a);u(S.message||"Membre créé avec succès."),setTimeout(()=>{n(S.member)},1e3)}catch(S){u(S.message||"Impossible de créer le membre.")}finally{h(!1)}},class:"mj-animateur-dashboard__modal-body",children:[_&&o("div",{class:"mj-animateur-dashboard__feedback is-info",children:_}),o("div",{class:"mj-animateur-dashboard__form-field",children:[o("label",{children:"Prénom *"}),o("input",{type:"text",value:a.first_name,onInput:f=>s("first_name",f.target.value),disabled:c,class:r.first_name?"has-error":""}),r.first_name&&o("span",{class:"mj-animateur-dashboard__field-error",children:r.first_name})]}),o("div",{class:"mj-animateur-dashboard__form-field",children:[o("label",{children:"Nom *"}),o("input",{type:"text",value:a.last_name,onInput:f=>s("last_name",f.target.value),disabled:c,class:r.last_name?"has-error":""}),r.last_name&&o("span",{class:"mj-animateur-dashboard__field-error",children:r.last_name})]}),o("div",{class:"mj-animateur-dashboard__form-field",children:[o("label",{children:"Date de naissance *"}),o("input",{type:"date",value:a.birth_date,onInput:f=>s("birth_date",f.target.value),disabled:c,max:new Date().toISOString().split("T")[0],class:r.birth_date?"has-error":""}),r.birth_date&&o("span",{class:"mj-animateur-dashboard__field-error",children:r.birth_date})]}),o("div",{class:"mj-animateur-dashboard__form-field",children:[o("label",{children:"Email"}),o("input",{type:"email",value:a.email,onInput:f=>s("email",f.target.value),disabled:c,class:r.email?"has-error":""}),r.email&&o("span",{class:"mj-animateur-dashboard__field-error",children:r.email})]}),o("div",{class:"mj-animateur-dashboard__modal-footer",children:[o("button",{type:"submit",class:"mj-animateur-dashboard__button",disabled:c,children:c?"Création...":"Créer le membre"}),o("button",{type:"button",class:"mj-animateur-dashboard__button mj-animateur-dashboard__button--secondary",onClick:t,disabled:c,children:"Annuler"})]})]})]})})}function ut(e){const[t,n]=C({eventId:null,occurrence:null,filter:"assigned"}),[a,l]=C([]),[r,i]=C({}),[c,h]=C([]);V(()=>{if(!e)return;const v=(e.events||[]).map(d=>{var $;const j=B(d==null?void 0:d.id);if(j===null)return null;const M=(d==null?void 0:d.status)||(($=d==null?void 0:d.meta)==null?void 0:$.status)||"",x=Re(M);return{...d,id:j,__isDraft:x,__statusValue:M}}).filter(Boolean);l(v);const g={};v.forEach(d=>{g[d.id]=d}),i(g);const b=(e.allEvents||[]).map(d=>{const j=B(d==null?void 0:d.id);if(j===null)return null;const M=(d==null?void 0:d.status)||(d==null?void 0:d.statusKey)||"",x=Re(M);return{id:j,title:(d==null?void 0:d.title)||`Événement #${j}`,dateLabel:(d==null?void 0:d.dateLabel)||"",status:(d==null?void 0:d.status)||"",statusKey:M,assigned:!!(d!=null&&d.assigned),isDraft:x,coverUrl:(d==null?void 0:d.coverUrl)||"",locationCoverUrl:(d==null?void 0:d.locationCoverUrl)||"",typeLabel:(d==null?void 0:d.typeLabel)||"",statusLabel:(d==null?void 0:d.statusLabel)||"",priceLabel:(d==null?void 0:d.priceLabel)||"",permalink:(d==null?void 0:d.permalink)||"",articlePermalink:(d==null?void 0:d.articlePermalink)||""}}).filter(Boolean);if(h(b),v.length>0){const d=v[0];n(j=>({...j,eventId:d.id,occurrence:d.defaultOccurrence||null}))}},[e]);const _=W(()=>t.eventId===null?null:r[t.eventId]||null,[t.eventId,r]),u=W(()=>t.occurrence?t.occurrence:_&&_.defaultOccurrence||null,[t.occurrence,_]),s=W(()=>(e==null?void 0:e.settings)||{},[e]),m=W(()=>({...window.MjMemberAnimateur||{},...(e==null?void 0:e.global)||{}}),[e]);return{state:t,events:a,allEvents:c,eventsById:r,settings:s,global:m,currentEvent:_,currentOccurrence:u,setEventId:v=>{n(g=>{const b=B(v),d=r[b];return{...g,eventId:b,occurrence:(d==null?void 0:d.defaultOccurrence)||null}})},setOccurrence:v=>{n(g=>({...g,occurrence:v}))},setState:n,updateEventSnapshot:v=>{if(!v)return;const g=B(v.id);if(g!==null&&(i(b=>({...b,[g]:v})),l(b=>{const d=b.findIndex(j=>j.id===g);if(d!==-1){const j=[...b];return j[d]=v,j}return b}),t.eventId===g)){const b=u;b&&v.occurrences&&(v.occurrences.some(j=>j.start===b)||n(j=>({...j,occurrence:v.defaultOccurrence||null})))}},addEvent:v=>{const g=B(v==null?void 0:v.id);g!==null&&(l(b=>b.some(d=>d.id===g)?b:[...b,v]),i(b=>({...b,[g]:v})))},removeEvent:v=>{const g=B(v);if(g!==null&&(l(b=>b.filter(d=>d.id!==g)),i(b=>{const{[g]:d,...j}=b;return j}),t.eventId===g)){const b=a.filter(d=>d.id!==g);n(d=>({...d,eventId:b.length>0?b[0].id:null,occurrence:null}))}}}}function ht({config:e}){var O,Be,qe;const{state:t,events:n,allEvents:a,settings:l,global:r,currentEvent:i,currentOccurrence:c,setEventId:h,setOccurrence:_,updateEventSnapshot:u}=ut(e),[s,m]=C({type:"",level:"",message:""}),[p,f]=C(!1),[S,y]=C(!1),[k,v]=C(!1);V(()=>{if(s.message){const E=setTimeout(()=>{m({type:"",level:"",message:""})},5e3);return()=>clearTimeout(E)}},[s]);const g=E=>{h(E),m({type:"",level:"",message:""})},b=E=>{_(E),m({type:"",level:"",message:""})},d=async(E,L,D)=>{if(!(!i||!c))try{f(!0);const U=await H("mj_member_animateur_save_attendance",{event_id:i.id,occurrence_start:c,entries:[{member_id:E,registration_id:L||0,status:D}]});if(U.counts){const K={...i},ze=K.occurrences.findIndex(mt=>mt.start===c);ze!==-1&&(K.occurrences[ze].counts=U.counts),u(K)}m({type:"attendance",level:"success",message:"Présence mise à jour."})}catch(U){m({type:"attendance",level:"error",message:U.message||"Impossible de mettre à jour la présence."})}finally{f(!1)}},j=async(E,L)=>{if(i)try{f(!0);const D=await H("mj_member_animateur_send_sms",{event_id:i.id,message:E,member_ids:L});m({type:"sms",level:"success",message:D.message||"SMS envoyé."})}catch(D){m({type:"sms",level:"error",message:D.message||"Impossible d'envoyer le SMS."})}finally{f(!1)}},M=async E=>{if(i)try{f(!0);const L=await H("mj_member_animateur_toggle_cash_payment",{event_id:i.id,registration_id:E}),D={...i},U=D.participants.find(K=>K.registrationId===E);U&&L.payment&&(U.payment=L.payment),u(D),m({type:"payment",level:"success",message:"Statut de paiement mis à jour."})}catch(L){m({type:"payment",level:"error",message:L.message||"Impossible de mettre à jour le paiement."})}finally{f(!1)}},x=async E=>{if(i&&confirm("Êtes-vous sûr de vouloir supprimer cette inscription ?"))try{f(!0);const L=await H("mj_member_animateur_remove_registration",{event_id:i.id,registration_id:E});L.event&&u(L.event),m({type:"attendance",level:"success",message:"Inscription supprimée."})}catch(L){m({type:"attendance",level:"error",message:L.message||"Impossible de supprimer l'inscription."})}finally{f(!1)}},$=E=>{E&&u(E),y(!1)},G=()=>{var E;v(!1),i&&((E=l.registrations)!=null&&E.canAdd)&&y(!0)},P=W(()=>!i||!c?[]:i.participants.filter(E=>{const L=E.occurrenceScope||{mode:"all"};return L.mode!=="custom"?!0:!L.occurrences||!L.occurrences.length?!1:L.occurrences.includes(c)}),[i,c]);return o("div",{class:"mj-animateur-dashboard__container",children:[e.title&&o("h2",{class:"mj-animateur-dashboard__title",children:e.title}),e.description&&o("p",{class:"mj-animateur-dashboard__intro",children:e.description}),s.message&&o("div",{class:`mj-animateur-dashboard__feedback is-${s.level}`,children:s.message}),o(nt,{events:n,allEvents:a,selectedId:t.eventId,onSelect:g,settings:l,global:r}),i&&o(F,{children:[o(rt,{occurrences:i.occurrences,selected:c,onSelect:b}),o("div",{class:"mj-animateur-dashboard__actions",children:((O=l.registrations)==null?void 0:O.canAdd)&&o(F,{children:[o("button",{class:"mj-animateur-dashboard__button",onClick:()=>y(!0),disabled:p,children:"Ajouter un participant"}),((Be=l.quickCreate)==null?void 0:Be.enabled)&&o("button",{class:"mj-animateur-dashboard__button",onClick:()=>v(!0),disabled:p,children:"Créer un membre"})]})}),o(lt,{participants:P,event:i,occurrence:c,settings:l,onAttendanceChange:d,onPaymentToggle:M,onRemoveRegistration:x,loading:p}),((qe=l.sms)==null?void 0:qe.enabled)&&o(_t,{participants:P,onSendSms:j,loading:p})]}),S&&i&&o(ct,{event:i,occurrence:c,global:r,onClose:()=>y(!1),onMembersAdded:$}),k&&o(dt,{global:r,onClose:()=>v(!1),onMemberCreated:G})]})}function We(){document.querySelectorAll(".mj-animateur-dashboard").forEach(t=>{const n=t.getAttribute("data-config");let a={};if(n)try{a=JSON.parse(n)}catch(l){console.error("Failed to parse dashboard config:",l)}Xe(ge(ht,{config:a}),t)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",We):We()})();
